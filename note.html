<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script>
      // 前端代码
      const app = document.getElementById("app");
      const noteInput = document.createElement("input");
      noteInput.placeholder = "输入笔记";
      const addButton = document.createElement("button");
      addButton.textContent = "添加笔记";
      const notesList = document.createElement("ul");

      addButton.onclick = async () => {
        const note = noteInput.value;
        if (!note) return;
        await fetch("/", { method: "POST", body: JSON.stringify({ note }) });
        noteInput.value = "";
        loadNotes();
      };

      async function loadNotes() {
        const res = await fetch("/");
        const notes = await res.json();
        notesList.innerHTML = "";
        notes.forEach(({ id, note }) => {
          const li = document.createElement("li");
          const noteText = document.createElement("span");
          noteText.textContent = note;
          const editButton = document.createElement("button");
          editButton.textContent = "编辑";
          editButton.onclick = async () => {
            const newNote = prompt("修改笔记", note);
            if (newNote) {
              await fetch(`/?id=${id}`, {
                method: "PUT",
                body: JSON.stringify({ note: newNote }),
              });
              loadNotes();
            }
          };
          li.appendChild(noteText);
          li.appendChild(editButton);
          notesList.appendChild(li);
        });
      }

      app.appendChild(noteInput);
      app.appendChild(addButton);
      app.appendChild(notesList);
      loadNotes();
    </script>

    <title>Cloudflare Pages Note</title>
  </head>
  <body>
    <h1>欢迎来到 Notes</h1>
    <p>点击以下链接访问 API：</p>
    <ul>
      <li><a href="/api">访问 /api</a></li>
      <li><a href="/hello">访问 /hello</a></li>
    </ul>
    <div id="app"></div>
  </body>
</html>
